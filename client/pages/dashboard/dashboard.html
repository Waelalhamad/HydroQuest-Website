<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Professional Dashboard</title>
    <link
      rel="shortcut icon"
      href="../../assets/favicon.ico"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="./pages/dashboard/assets/css/styles.css" />
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>


    <!-- Link to Font Awssome cdn becasue this library contain good icon to home -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>

  <body>
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div id="main-content">
      <!-- Component Content will be dynamically loaded here -->
      <div id="component-view"></div>
    </div>

    <script>
      // Function to check if the element is available and update the src
      function setupWebSocket() {
        const videoFrame = document.getElementById("videoFrame");

        if (videoFrame) {
          // Create a WebSocket connection
          const ws = new WebSocket("ws://localhost:3000");

          ws.onmessage = async function (event) {
            try {
              let data;
              if (event.data instanceof Blob) {
                // If it's a Blob, read it as text
                data = await event.data.text();
              } else {
                // If it's already text, use it directly
                data = event.data;
              }

              // Parse the JSON data
              const jsonData = JSON.parse(data);

              // Check if the JSON data contains an image
              if (jsonData.image) {
                // Set the image src to display the live feed
                videoFrame.src = "data:image/jpeg;base64," + jsonData.image;
              } else {
                console.warn("No image data found in WebSocket message");
              }
            } catch (error) {
              console.error("Error processing WebSocket message:", error);
            }
          };

          ws.onerror = function (error) {
            console.error("WebSocket Error:", error);
          };

          ws.onclose = function () {
            console.log("WebSocket connection closed");
          };
        } else {
          // If videoFrame is not found, retry after a short delay
          setTimeout(setupWebSocket, 100); // Retry every 100ms
        }
      }

      // Call setupWebSocket function after DOM content is fully loaded
      document.addEventListener("DOMContentLoaded", setupWebSocket);
    </script>

    <script src="./pages/dashboard/assets/js/app.js"></script>
    <script src="./pages/dashboard/assets/js/charts.js"></script>
  </body>
</html>
